extends layout

block content
  .container.mt-4
    // Hero section
    .row.mb-5
      .col-12.text-center
        h2.display-4= welcomeHeader || "Welcome to My Digital Diary"
        p.lead= welcomeMessage || "This is my personal digital space where I share my thoughts, experiences, and memories."

    // Search section
    .row.mb-4
      .col-md-8.offset-md-2
        .search-box
          .input-group
            input.form-control(type="text" placeholder=searchPlaceholder || "Search my diary..." id="search-input")
            button.btn.btn-primary(onclick="performSearch()")
              i.fas.fa-search.me-2
              = searchButtonText || "Search"

    // Filter by tags section
    .row.mb-4
      .col-12
        h3.mb-3 Filter by Tag
        .tag-list#filter-tags
          .btn.btn-outline-secondary.me-2.mb-2(onclick="filterByTag('All')") All
          each tag in allTags || []
            .btn.btn-outline-primary.me-2.mb-2(onclick=`filterByTag('${tag.name}')`)= tag.name

    // Recent entries section
    .row
      .col-12
        h3.mb-4= entriesHeader || "Recent Entries"
        
        if entries && entries.length > 0
          .timeline
            each entry in entries
              .card.mb-4.shadow-sm
                .card-body
                  .row
                    .col-md-2.text-center
                      .timeline-date.badge.bg-primary.fs-6= entry.date
                    .col-md-10
                      h4.card-title= entry.title
                      p.card-text= entry.excerpt
                      
                      // Tags
                      if entry.tags && entry.tags.length
                        .mb-3
                          each tag in entry.tags
                            if tag && tag.name
                              span.badge.bg-secondary.me-1= tag.name
                      
                      // Read more button
                      if entry.id
                        a.btn.btn-outline-primary(href=`/entry/${entry.id}`)
                          = readMoreText || "Read More"
                          i.fas.fa-arrow-right.ms-2
                      else
                        button.btn.btn-outline-secondary(disabled style="opacity: 0.5")
                          = readMoreText || "Read More (No ID)"
        else
          .text-center.py-5
            i.fas.fa-book-open.fa-3x.text-muted.mb-3
            p.text-muted.fs-5= noEntriesMessage || "No entries found."
            if isAuthenticated
              a.btn.btn-primary(href="/entry/new") Create Your First Entry

    // DEBUG section (only in development)
    if process.env.NODE_ENV === 'development'
      .row.mt-5
        .col-12
          details.bg-light.p-3.rounded
            summary.fw-bold Debug: Entry Data
            pre.mt-2.small(style="white-space: pre-wrap;")= JSON.stringify(entries, null, 2)

block scripts
  script.
    function performSearch() {
      const query = document.getElementById('search-input').value;
      if (query.trim()) {
        window.location.href = `/search?q=${encodeURIComponent(query)}`;
      }
    }
    
    function filterByTag(tagName) {
      if (tagName === 'All') {
        window.location.href = '/timeline';
      } else {
        const tagSlug = tagName.toLowerCase().replace(/\s+/g, '-');
        window.location.href = `/timeline?tag=${tagSlug}`;
      }
    }
    
    // Allow search on Enter key
    document.getElementById('search-input').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        performSearch();
      }
    });