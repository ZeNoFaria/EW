extends layout

block content
  .mockup
    .mockup-header
      h3= siteName || "My Digital Diary"
      div
        if user
          button.btn= user.name
        else
          button.btn Login

    .nav
      ul
        each item in navItems || [{text: "Homepage", url: "/", active: false}, {text: "Categories", url: "/categories", active: false}, {text: "Tags", url: "/tags", active: false}, {text: "About", url: "/about", active: false}]
          li
            a(href=item.url, class=item.active ? "active" : "")= item.text

    .mockup-body
      if entry
        article.entry-detail
          header.entry-header
            h1.entry-title= entry.title
            .entry-meta
              time.entry-date= entry.date
              if entry.category
                span.entry-category= entry.category
              if entry.tags && entry.tags.length > 0
                .tag-list
                  each tag in entry.tags
                    span.tag= tag

          .entry-content
            if entry.content
              div!= entry.content.replace(/\n/g, '<br>')
            else if entry.excerpt
              p= entry.excerpt
            else
              p No content available.

          footer.entry-footer
            .entry-actions
              button.btn.btn-secondary(onclick="history.back()") ← Back
              button.btn.btn-secondary(onclick=`shareEntry('${entry.id}', '${entry.title}')`) Share
              if entry.editUrl
                a.btn(href=entry.editUrl) Edit

            if entry.relatedEntries && entry.relatedEntries.length > 0
              .related-entries
                h3 Related Entries
                .related-list
                  each related in entry.relatedEntries
                    .related-item
                      h4
                        a(href=`/entry/${related.id}`)= related.title
                      p= related.excerpt
                      time= related.date

      else
        .error-message
          h2 Entry Not Found
          p The entry you're looking for doesn't exist or has been removed.
          a.btn(href="/") ← Back to Home

  script.
    function shareEntry(id, title) {
      if (navigator.share) {
        navigator.share({
          title: title,
          text: `Check out this diary entry: ${title}`,
          url: window.location.href
        }).catch(err => console.log('Error sharing:', err));
      } else {
        // Fallback: copy to clipboard
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
          alert('Link copied to clipboard!');
        }).catch(() => {
          // Final fallback: show URL in prompt
          prompt('Copy this link:', url);
        });
      }
    }